<!-- ocr-upload.component.html - SimplifiÃ© pour l'analyse -->
<div class="ocr-container">
  <div class="header">
    <h1>ğŸ” Analyse OCR</h1>
    <p>SÃ©lectionnez une entitÃ© et analysez vos documents</p>
  </div>

  <!-- SÃ©lection d'entitÃ© -->
  <div class="entity-selector">
    <label for="entite">ModÃ¨le d'entitÃ© :</label>
    <select id="entite" [ngModel]="selectedEntite()" (ngModelChange)="selectedEntite.set($event)">
      <option value="none">Aucun (zones par dÃ©faut)</option>
      @for (entite of entites(); track entite.nom) {
      <option [value]="entite.nom">{{ entite.nom }}</option>
      }
    </select>
  </div>

  <!-- Upload Section -->
  <div class="upload-section">
    <div class="file-input-wrapper">
      <input type="file" id="fileInput" accept="image/*,.pdf" (change)="onFileSelected($event)" #fileInput>
      <label for="fileInput" class="file-label">
        ğŸ“ Choisir une image ou un PDF
      </label>
      @if (selectedFile()) {
      <span class="file-name">{{ selectedFile()!.name }}</span>
      }
    </div>

    <button class="btn btn-primary" (click)="uploadImage()" [disabled]="!selectedFile() || isUploading()">
      @if (isUploading()) {
      <span class="spinner"></span> Upload en cours...
      } @else {
      â¬†ï¸ Uploader
      }
    </button>
  </div>

  <!-- Image Preview with Canvas -->
  @if (imageUrl()) {
  <div class="image-preview">
    <h3>Image uploadÃ©e avec zones de l'entitÃ© :</h3>
    <canvas #canvas style="max-width: 100%; border: 2px solid #ccc;"></canvas>
  </div>
  }

  <!-- Analyse Button -->
  @if (uploadedFilename()) {
  <div class="analyze-section">
    <button class="btn btn-success" (click)="analyser()" [disabled]="isAnalyzing()">
      @if (isAnalyzing()) {
      <span class="spinner"></span> Analyse en cours...
      } @else {
      ğŸ” Analyser avec OCR
      }
    </button>
  </div>
  }

  <!-- Error Message -->
  @if (errorMessage()) {
  <div class="error-message">
    âš ï¸ {{ errorMessage() }}
  </div>
  }

  <!-- Results -->
  @if (analyseResults()) {
  <div class="results-section">
    <div class="results-header">
      <h2>ğŸ“Š RÃ©sultats de l'analyse</h2>
      <button class="btn btn-secondary" (click)="exportResults()">
        ğŸ’¾ Exporter JSON
      </button>
    </div>

    <!-- Stats -->
    <div class="stats">
      <div class="stat-card">
        <span class="stat-label">Zones analysÃ©es</span>
        <span class="stat-value">{{ getResultatsArray().length }}</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Alertes</span>
        <span class="stat-value alert">{{ analyseResults()!.alertes.length }}</span>
      </div>
      @for (moteur of analyseResults()!.stats_moteurs | keyvalue; track moteur.key) {
      <div class="stat-card">
        <span class="stat-label">{{ moteur.key }}</span>
        <span class="stat-value">{{ moteur.value }}</span>
      </div>
      }
    </div>

    <!-- Results Table -->
    <div class="results-table">
      <table>
        <thead>
          <tr>
            <th>Zone</th>
            <th>Texte dÃ©tectÃ©</th>
            <th>Confiance</th>
            <th>Moteur</th>
            <th>Statut</th>
          </tr>
        </thead>
        <tbody>
          @for (result of getResultatsArray(); track result.zone) {
          <tr>
            <td class="zone-name">{{ result.zone }}</td>
            <td class="text-content">{{ result.texte_auto || '(vide)' }}</td>
            <td class="confidence">
              <div class="confidence-bar">
                <div class="confidence-fill" [style.width.%]="result.confiance_auto * 100">
                </div>
                <span class="confidence-text">
                  {{ (result.confiance_auto * 100).toFixed(0) }}%
                </span>
              </div>
            </td>
            <td class="moteur">
              <span class="badge badge-moteur">{{ result.moteur }}</span>
              @if (result.ameliore_par) {
              <span class="badge badge-improved">â†’ {{ result.ameliore_par }}</span>
              }
            </td>
            <td>
              <span [class]="'badge ' + getStatutClass(result.statut)">
                {{ result.statut }}
              </span>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <button class="btn btn-outline" (click)="reset()">
      ğŸ”„ Nouvelle analyse
    </button>
  </div>
  }
</div>